#!/bin/bash
set -euo pipefail

echo "BUILDKITE command: ${BUILDKITE_COMMAND:-}"
echo "BUILDKITE path: ${BUILDKITE_BUILD_CHECKOUT_PATH:-}"
echo "BUILDKITE smith target: $SMITH_TARGET, MG share: $MG_SHR"
rc="${BUILDKITE_RETRY_COUNT:-0}"
echo "BUILDKITE clean checkout: $rc"

if [[ "$rc" != "0" ]]; then
  echo "cleaning smith dir..."
  rm -rf /smith/**
  rm -rf /smith/.* 2> /dev/null || true
fi
