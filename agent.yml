  agent_{{SMITH_TARGET}}:
    container_name: agent_{{SMITH_TARGET}}
    image: inzania/agent:latest
    build:
      context: ./agent
    environment:
      - MG_SHR=${MG_SHR}
      - BUILDKITE_S3_ACL=${S3_ACL:-private}
      - BUILDKITE_S3_DEFAULT_REGION=${AWS_DEFAULT_REGION:-us-east-1}
      - BUILDKITE_S3_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - BUILDKITE_S3_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - BUILDKITE_AGENT_CONFIG=/etc/buildkite-agent/buildkite-agent.cfg
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-us-east-1}
      - SMITH_TARGET={{SMITH_TARGET}}
    volumes:
      - ${MG_SHR}/builds:/buildkite/builds
      - ${MG_SHR}/smith-{{SMITH_TARGET}}:/smith
      - /var/run/docker.sock:/var/run/docker.sock
      - type: bind
        read_only: true
        source: ${MG_SHR}/.ss3/
        target: /ss3/
